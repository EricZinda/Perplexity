<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Perplexity</title>
<meta name="description" content="An amazing website.">


  <meta name="author" content="Your Name">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Perplexity">
<meta property="og:title" content="Perplexity">
<meta property="og:url" content="http://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo120ConceptsReferringExpressions/">


  <meta property="og:description" content="An amazing website.">











  

  


<link rel="canonical" href="http://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo120ConceptsReferringExpressions/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Your Name",
      "url": "http://blog.inductorsoftware.com/Perplexity/home/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/Perplexity/home/feed.xml" type="application/atom+xml" rel="alternate" title="Perplexity Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Perplexity/home/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--delphin_page wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/Perplexity/home/"><img src="/Perplexity/home/assets/images/Delph-In.png" alt="Perplexity"></a>
        
        <a class="site-title" href="/Perplexity/home/">
          Perplexity
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/Perplexity/home/devOverview">Home</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Developer Tutorial Overview</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devOverview/">Overview</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">MRS Conceptual</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/mrscon/devhowto0010MRS/">Minimal Recursion Semantics (MRS)</a></li>
          
            <li><a href="/Perplexity/home/mrscon/devhowto0020WellFormedTree/">Well-Formed Trees</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">MRS Solver Conceptual</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devcon/devcon0000Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0010MRSSolver/">Backtracking</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0020MRSSolverSets/">Representing 'Together'</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0030MRSSolverSolutionGroups/">Collective, Distributive, Cumulative</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0060WhichParseAndTree/">Choosing a Parse and Tree</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0070SentenceForce/">Sentence Types</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0080ErrorsChoosingWhichFailure/">Choosing a Failure</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0040MRSSolverSolutionGroupsAlgorithm/">A. Implementing Solution Groups</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0050MRSSolverSolutionCombinations/">B. Optimizing Solution Groups</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Using Perplexity</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo010Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxHowTo/pxHowTo012Install/">Installing Perplexity</a></li>
          
            <li><a href="/Perplexity/home/pxHowTo/pxHowTo014HelloWorld/">Hello World</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo020ImplementAPredication/">Implementing a Predication</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo022Testing/">Testing</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo030InStylePredications/">In-Style Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo040LiftStylePredications/">Lift-Style Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo050EventPredications/">Event Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo070ActionVerbs/">Verb Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo082State/">Custom State</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo085Place/">Representing Places</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo090Prepositions/">Directional Propositions</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo100NonlogicalMeaning/">Solution Group Handlers and Non-logical Meaning</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo105GlobalCriteria/">Solution Group Handlers and Global Criteria</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo110HandlingTenses/">Handling Tenses</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo120ConceptsReferringExpressions/" class="active">Conceptual References</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo080QuantifiersAndDeterminers/">Quantifiers and Determiners</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo130OpenClassWords/">Centralizing Nouns/Adjectives</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo025SStrings/">A. Generating English with S-strings</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Perplexity Internals</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/pxint/pxint0000Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0010PredicationContract/">The Predication Contract</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0020PythonBasics/">State and Python Basics</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0030ImplementPredication/">Implementing a Predication</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0040BuildSolver/">Initial Solver</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0050Conjunctions/">Solving Conjunctions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0060ScopalArguments/">Solving Scopal Arguments</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0080SimplePropositions/">Propositions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0090SimpleQuestions/">Questions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0100SimpleCommands/">Commands</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0105ErrorsChoosingWhichFailure/">Choosing a Failure</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0110ErrorsReportingAFailure/">Naive Failure Text</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0120ErrorsConceptualFailures/">English Variable Domains</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0070GenerateMRSAndTrees/">Generating MRS and Trees</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0071WhichParseAndTree/">Choosing a Parse and Tree</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0230Summary/">Summary</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint03000PythonDecorators/">A. Python Decorators</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h1 id="manipulating-conceptual-references">Manipulating Conceptual References</h1>
<p>Let’s now implement something that really has to deal with a concept as a <em>thing</em>: creating a file.</p>

<p>Let’s say we want to support phrases like:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create a file
create a text file
create a test file containing "Hello World"
create a test file containing "Hello World" with read-only permissions
etc.
</code></pre></div></div>

<p>Everything to the right of “create a” is a <a href="https://en.wikipedia.org/wiki/Referring_expression">referring expression</a>, basically an arbitrarily complex noun phrase that describes or “refers to” something. When that “something” is actually in the world, the techniques we have gone through so far are sufficient to handle it. But in creating files, we are describing something that does not yet exist, so writing predications that find objects in the world and return them won’t work. We need a different approach.</p>

<p>The Perplexity <code class="language-plaintext highlighter-rouge">Concept</code> object gives us a direction, but we’ll need to enhance it. We will create a richer kind of <code class="language-plaintext highlighter-rouge">Concept</code> object that can hold a representation of these “conceptual” referring expressions and build predications that use them.</p>

<h3 id="creating-a-file">Creating a File</h3>
<p>Below is the built-in <code class="language-plaintext highlighter-rouge">Concept</code> object. Its default implementation just stores a single string from the constructor called <code class="language-plaintext highlighter-rouge">sort_of</code> which represents the sort of concept it is.  Period. It doesn’t do anything with it. As far as Perplexity is concerned, the only part of it that gets used is the <code class="language-plaintext highlighter-rouge">value_type</code> property which returns <code class="language-plaintext highlighter-rouge">VariableValueType.concept</code>.  This tells Perplexity “I am a concept, treat me as an opaque blob”.  The rest of the methods are there to support equality and membership in dictionaries and are use by things like the Python <code class="language-plaintext highlighter-rouge">dict</code> object:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class Concept(object):
    def __init__(self, sort_of):
        # This is a set so it is more easily comparable since order doesn't matter
        self._sort_of_criteria = set([sort_of]) if sort_of is not None else set()
        self._hash = None

    def __repr__(self):
        return f"Concept({','.join(self._sort_of_criteria)})"

    # The only required property is that objects which compare equal have the same hash value
    # But: objects with the same hash aren't required to be equal
    # It must remain the same for the lifetime of the object
    def __hash__(self):
        if self._hash is None:
            # TODO: Make this more efficient
            self._hash = hash(tuple(self._sort_of_criteria))

        return self._hash

    def __eq__(self, other):
        if isinstance(other, Concept) and self.__hash__() == other.__hash__():
            return True

    def value_type(self):
        return VariableValueType.concept
</code></pre></div></div>

<p>Let’s start by implementing “create a file” using this class.  Looking at the MRS:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? create a file
I don't know the words: create

? /show
User Input: create a file
4 Parses

***** CHOSEN Parse #0:
Sentence Force: prop-or-ques
[ "create a file"
  TOP: h0
  INDEX: e2 [ e SF: prop-or-ques TENSE: tensed MOOD: indicative PROG: - PERF: - ]
  RELS: &lt; [ _create_v_1&lt;0:6&gt; LBL: h1 ARG0: e2 ARG1: i3 ARG2: x4 [ x PERS: 3 NUM: sg IND: + ] ]
          [ _a_q&lt;7:8&gt; LBL: h5 ARG0: x4 RSTR: h6 BODY: h7 ]
          [ _file_n_of&lt;9:13&gt; LBL: h8 ARG0: x4 ARG1: i9 ] &gt;
  HCONS: &lt; h0 qeq h1 h6 qeq h8 &gt; ]
</code></pre></div></div>

<p>… we can see that we’ll need to implement a new version of <code class="language-plaintext highlighter-rouge">_file_n_of</code> that creates a <code class="language-plaintext highlighter-rouge">Concept</code> instead of actual files as the current one does. The base <code class="language-plaintext highlighter-rouge">Concept</code> class is enough for this. Our implementation will be an exact copy of the <code class="language-plaintext highlighter-rouge">_command_n_1</code> implementation we built in the <a href="https://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo100NonlogicalMeaning">Non-logical meaning section</a>, just replacing the string “command” with “file”:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, names=["_file_n_of"])
def file_n_of_concept(context, state, x_binding, i_binding):
    def bound_variable(value):
        if isinstance(value, Concept) and value == Concept("file"):
            return True
        else:
            context.report_error(["valueIsNotX", value, x_binding.variable.name])
            return False

    def unbound_variable():
        yield Concept("file")

    yield from combinatorial_predication_1(context,
                                           state,
                                           x_binding,
                                           bound_variable,
                                           unbound_variable)
</code></pre></div></div>

<p>Next we’ll implement <code class="language-plaintext highlighter-rouge">_create_v_1</code> exactly like we implemented <code class="language-plaintext highlighter-rouge">_delete_v_1</code> in the <a href="https://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo070ActionVerbs">action verbs section</a>. It will use a new operation (which we’ll implement next) called <code class="language-plaintext highlighter-rouge">CreateOperation</code> to do the creating.  For now, we’ll just hard code the name of the file to be “newfile”:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, names=["_create_v_1"])
def create_v_1_comm(context, state, e_introduced_binding, x_actor_binding, x_what_binding):
    def criteria(value):
        # Only allow creating conceptual files
        if isinstance(value, Concept) and value == Concept("file"):
            return True

        else:
            context.report_error(["cantDo", "create", x_what_binding.variable.name])

    def unbound_what():
        context.report_error(["cantDo", "create", x_what_binding.variable.name])

    for success_state in individual_style_predication_1(context,
                                                        state,
                                                        x_what_binding,
                                                        criteria,
                                                        unbound_what,
                                                        ["cantXYTogether", "create", x_what_binding.variable.name]):
        object_to_create_binding = success_state.get_binding(x_what_binding.variable.name)
        operation = CreateOperation(object_to_create_binding, "newfile")
        yield success_state.apply_operations([operation])
</code></pre></div></div>

<p>And finish by implementing <code class="language-plaintext highlighter-rouge">CreateOperation</code>. It does the actual creating by calling our file system object (the code for that is not shown):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class CreateOperation(object):
    def __init__(self, binding_to_create, file_name):
        self.binding_to_create = binding_to_create
        self.file_name = file_name

    def apply_to(self, state):
        state.file_system.create_item(self.binding_to_create, self.file_name)
</code></pre></div></div>

<p>Now we can run it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? create a file
Done!
</code></pre></div></div>

<p>Not very exciting and since we don’t have a way to list files, we’ll have to trust that it works or examine in the debugger.</p>

<p>To get this far, we’ve used concepts we’ve already explained in previous sections that should be relatively familiar. Next, we’ll cover some new ground.</p>

<h3 id="a-richer-concept">A Richer Concept</h3>
<p>Let’s now tackle the next phrase from our list at the beginning of this section: “create a text file”. As always, we’ll start by examining the MRS to see what predications we need to implement:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? create a text file
I don't know the words: text, text file

? /show
User Input: create a text file
4 Parses

***** CHOSEN Parse #1:
Sentence Force: comm
[ "create a text file"
  TOP: h0
  INDEX: e2 [ e SF: comm TENSE: pres MOOD: indicative PROG: - PERF: - ]
  RELS: &lt; [ pronoun_q&lt;0:18&gt; LBL: h4 ARG0: x3 [ x PERS: 2 PT: zero ] RSTR: h5 BODY: h6 ]
          [ pron&lt;0:18&gt; LBL: h7 ARG0: x3 ]
          [ _create_v_1&lt;0:6&gt; LBL: h1 ARG0: e2 ARG1: x3 ARG2: x8 [ x PERS: 3 NUM: sg IND: + ] ]
          [ _a_q&lt;7:8&gt; LBL: h9 ARG0: x8 RSTR: h10 BODY: h11 ]
          [ compound&lt;9:18&gt; LBL: h12 ARG0: e13 [ e SF: prop TENSE: untensed MOOD: indicative PROG: - PERF: - ] ARG1: x8 ARG2: x14 ]
          [ udef_q&lt;9:13&gt; LBL: h15 ARG0: x14 RSTR: h16 BODY: h17 ]
          [ _text_n_of&lt;9:13&gt; LBL: h18 ARG0: x14 ARG1: i19 ]
          [ _file_n_of&lt;14:18&gt; LBL: h12 ARG0: x8 ARG1: i20 ] &gt;
  HCONS: &lt; h0 qeq h1 h5 qeq h7 h10 qeq h12 h16 qeq h18 &gt; ]

-- CHOSEN Parse #1, CHOSEN Tree #0: 

                                                                  ┌── _file_n_of(x8,i20)
             ┌────── _text_n_of(x14,i19)                          │
             │                                        ┌────── and(0,1)
udef_q(x14,RSTR,BODY)               ┌────── pron(x3)  │             │
                  │                 │                 │             └ compound(e13,x8,x14)
                  └─ pronoun_q(x3,RSTR,BODY)          │
                                         └─ _a_q(x8,RSTR,BODY)
                                                           └─ _create_v_1(e2,x3,x8)
</code></pre></div></div>
<p>There are 2 new predications to implement: <code class="language-plaintext highlighter-rouge">_text_n_of</code> and <code class="language-plaintext highlighter-rouge">compound</code>.  Basically, the ERG is creating the concept of “text” and the concept of “file” and combining them together with the <code class="language-plaintext highlighter-rouge">compound</code> predication. <code class="language-plaintext highlighter-rouge">_text_n_of</code> will end up looking just like <code class="language-plaintext highlighter-rouge">_file_n_of</code> above:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, names=["_text_n_of"])
def text_n_of_concept(context, state, x_binding, i_binding):
    def bound_variable(value):
        if isinstance(value, Concept) and value == Concept("text"):
            return True
        else:
            context.report_error(["valueIsNotX", value, x_binding.variable.name])
            return False

    def unbound_variable():
        yield Concept("text")

    yield from combinatorial_predication_1(context,
                                           state,
                                           x_binding,
                                           bound_variable,
                                           unbound_variable)
</code></pre></div></div>

<p>Next up is <code class="language-plaintext highlighter-rouge">compound(e13,x8,x14)</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">x8</code> in <code class="language-plaintext highlighter-rouge">compound</code> is always the “base object”, i.e. “seat” in “bicycle seat”, “food” in “baby food”, etc.</p>

<p><code class="language-plaintext highlighter-rouge">x14</code> is the modifier which filters down what <em>kind</em> of base object we are discussing.</p>

<p>If we were working with object instances (and not concepts) we would simply do a check to see if <code class="language-plaintext highlighter-rouge">x8</code> is an “<code class="language-plaintext highlighter-rouge">x14</code> kind of object” and succeed or not. But, because we are building up a <em>concept</em>, we actually need to <em>modify</em> the value in <code class="language-plaintext highlighter-rouge">x8</code> to include that additional description so that downstream predications see a concept that is a “text” kind of “file”. We need to enhance the “Concept” object to support this. Since Perplexity doesn’t care about the <code class="language-plaintext highlighter-rouge">Concept</code> object, per se, and only cares that the object has the <code class="language-plaintext highlighter-rouge">value_type</code> method on it, we can just create our own <code class="language-plaintext highlighter-rouge">RichConcept</code> object and use that.</p>

<p>To do this, we need start building up a simple way of describing things. We’ll describe a referred-to-thing with a list of “criteria”, which are simply “relationships” and “values”.  For example:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Description of "text file":
    object "is_a" "file"
    object "has_adjective" "text"
</code></pre></div></div>

<p>Here is the implementation of that:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class RichConcept:
    def __init__(self, is_a=None):
        self.criteria = [] if sort_of is None else [("is_a", sort_of)]
        self._hash = None

    def __repr__(self):
        return f"RichConcept({[x for x in self.criteria]})"

    # The only required property is that objects which compare equal have the same hash value
    # But: objects with the same hash aren't required to be equal
    # It must remain the same for the lifetime of the object
    def __hash__(self):
        if self._hash is None:
            self._hash = hash(tuple(self.criteria))

        return self._hash

    def __eq__(self, other):
        if isinstance(other, RichConcept) and self.__hash__() == other.__hash__():
            return True

    def value_type(self):
        return VariableValueType.concept

    def add_criteria(self, relationship, value):
        self_copy = copy.deepcopy(self)
        self_copy.criteria.append((relationship, tuple))
        self_copy._hash = None
        return self_copy
</code></pre></div></div>

<p>And with that in place we can tackle <code class="language-plaintext highlighter-rouge">compound</code>.  The way things are currently implemented, for the phrase “create a text file”, <code class="language-plaintext highlighter-rouge">compound</code> will get called with its arguments set to:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>compound(e13,x8,x14)
x8 = RichObject("file")   # object "is_a" "file"
x14 = RichObject("text")  # object "is_a" "text"
</code></pre></div></div>

<p>This isn’t quite right. A text file “is_a” file, but it “has” text, it is not “text”.</p>

<p>The problem is in how we’ve interpreted the predications <code class="language-plaintext highlighter-rouge">_text_n_of</code> and <code class="language-plaintext highlighter-rouge">_file_n_of</code>.  Normally, these predications should be <code class="language-plaintext highlighter-rouge">true</code> for objects that “are” (i.e. “is_a”) that kind of thing. That is how they are implemented and that is the kind of <code class="language-plaintext highlighter-rouge">Concept</code> being returned by them at the moment. But when used with <code class="language-plaintext highlighter-rouge">compound</code>, the 2nd argument is used more like an adjective than a noun.  Consider “baby food”. A jar of baby food is <em>not</em> a baby. “Baby” is being used as an adjective.</p>

<p>The problem is that <code class="language-plaintext highlighter-rouge">text_n_of</code> (or “baby”) get called without knowing this is how they’ll be used. So, we can either write two different <em>interpretations</em> for all noun predications: one interpreting as “is_a” and one interpreting as “has_adjective” and then compound will always only be <code class="language-plaintext highlighter-rouge">true</code> for the second.  Or: we can have the <code class="language-plaintext highlighter-rouge">compound</code> predication do some special magic to interpret nouns as adjectives.</p>

<p>Since we don’t have other predications that need to treat nouns as adjectives, for now we’ll centralize the code in <code class="language-plaintext highlighter-rouge">compound</code> to save work. We will add a method to our <code class="language-plaintext highlighter-rouge">RichConcept</code> class called <code class="language-plaintext highlighter-rouge">add_adjective_concept</code>. This method will simply convert “is_a” relationships to “has_adjective” relationships and then add to the base object:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class RichConcept:
    
    ...
    
    def add_criteria(self, relationship, value):
        self_copy = copy.deepcopy(self)
        self_copy.criteria.append((relationship, tuple))
        self_copy._hash = None
        return self_copy

    def add_adjective_concept(self, other_concept):
        self_copy = copy.deepcopy(self)
        for criteria in other_concept.criteria:
            if criteria[0] == "is_a":
                self_copy.criteria.append(("has_adjective", criteria[1]))
            else:
                self_copy.criteria.append(criteria)
        self_copy._hash = None
        return self_copy
</code></pre></div></div>

<p>This makes <code class="language-plaintext highlighter-rouge">compound</code> easy to write. Due to the way it is used in English, it will always have both arguments bound: there isn’t a way to make a compound word where you are asking what the first part is that will generate this predication. So, all we need to do is use our new method to combine the second argument into the first and yield that as the new first argument:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary,
             names=["compound"])
def compound_concept(context, state, e_introduced_binding, x_base_binding, x_modifier_binding):
    # Only support concepts
    # Both arguments will always be bound for compound 
    # so we don't need to check unbound cases. Furthermore, the value will always be
    # a single value due to the way it is parsed, so we only need to check the first value
    if not isinstance(x_base_binding.value[0], RichConcept) or not isinstance(x_modifier_binding.value[0], RichConcept):
        context.report_error(["formNotUnderstood"])
        return
    
    compound_value = x_base_binding.value[0].add_adjective_concept(x_modifier_binding.value[0])
    yield state.set_x(x_base_binding.variable.name, (compound_value, ))   
</code></pre></div></div>

<p>Note the use of the special error “formNotUnderstood” if the predication is called with a value that is not a <code class="language-plaintext highlighter-rouge">RichConcept</code>. This tells the system, “this predication is not appropriate for these values”. It is neither <code class="language-plaintext highlighter-rouge">true</code> nor <code class="language-plaintext highlighter-rouge">false</code>. It allows the system to give better errors.</p>

<p>The final code we need to write is in the <code class="language-plaintext highlighter-rouge">CreateOperation</code> and underlying filesystem objects that actually do the work.</p>

<p><code class="language-plaintext highlighter-rouge">CreateOperation</code> doesn’t need to change since it just passes along the values:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class CreateOperation(object):
    def __init__(self, binding_to_create, file_name):
        self.binding_to_create = binding_to_create
        self.file_name = file_name

    def apply_to(self, state):
        state.file_system.create_item(self.binding_to_create, self.file_name)
</code></pre></div></div>

<p>The real work happens in the <code class="language-plaintext highlighter-rouge">FileSystem</code> object that haven’t really gone through.  The pertinent code is below.  It does the work of finding the one adjective that describes the type of file to creating and failing if there is none or more than one.  Obviously this code could be made more robust, but that isn’t what we’re focused on here. This is just a simple implementation:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class FileSystem:
    ...
    
    def get_file_type(self, concept):
        file_type = None
        for criteria in concept.criteria:
            if criteria[0] == "has_adjective":
                if file_type is None:
                    file_type = criteria[1]
                else:
                    # More than one type described, fail
                    return None
        
        return file_type
</code></pre></div></div>

<p>If we now run a test, we get this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? create a text file
[7, ['cantDo', 'create', 'x8'], 0]
</code></pre></div></div>

<p>(We haven’t added to code to make a nice error yet …)</p>

<h3 id="logical-entailment">Logical Entailment</h3>

<p>The problem is in the implementation of <code class="language-plaintext highlighter-rouge">_create_v_1</code>.  It checks to see if its argument <code class="language-plaintext highlighter-rouge">== RichConcept("file")</code>, but the <code class="language-plaintext highlighter-rouge">Concept</code> is no longer simply a file, it is a <code class="language-plaintext highlighter-rouge">RichConcept([('is_a', 'file'), ('has_adjective', 'text')])</code>, so it fails:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, names=["_create_v_1"])
def create_v_1_comm(context, state, e_introduced_binding, x_actor_binding, x_what_binding):
    def criteria(value):
        # Only allow creating conceptual files
        if isinstance(value, RichConcept) and value == RichConcept("file"):
            return True

        else:
            context.report_error(["cantDo", "create", x_what_binding.variable.name])
    
    ...
</code></pre></div></div>

<p>As far as this predication is concerned, we don’t care what <em>type</em> of file the user asked to create, that will be dealt with elsewhere.  We just care that it is, at its core, a <em>file</em>.  Here, we can appeal to a concept from logic called “logical consequence” or <a href="https://en.wikipedia.org/wiki/Logical_consequence">“logical entailment”</a>.  Really, you can think of it as “implies”.  Being a “text file” will always mean it is also a “file”. So, “text file” <em>entails</em> “file” or “text file” <em>implies</em> “file”. In this function we want to check for <em>entailment</em> of “file”, not equality.</p>

<p>Now, proving entailment is an active area of research. It is a hard problem. But we don’t have the general case here, we have a very limited vocabulary and set of scenarios.  We can therefore just say that something entails something else as long as they both “is_a” the same thing:</p>

<p>Let’s add a method to our <code class="language-plaintext highlighter-rouge">Concept</code> object to do that (the last method below):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class RichConcept:
    def __init__(self, is_a=None):
        self.criteria = [] if is_a is None else [("is_a", is_a)]
        self._hash = None

    def __repr__(self):
        return f"RichConcept({[x for x in self.criteria]})"

    # The only required property is that objects which compare equal have the same hash value
    # But: objects with the same hash aren't required to be equal
    # It must remain the same for the lifetime of the object
    def __hash__(self):
        if self._hash is None:
            self._hash = hash(tuple(self.criteria))

        return self._hash

    def __eq__(self, other):
        if isinstance(other, RichConcept) and self.__hash__() == other.__hash__():
            return True

    def value_type(self):
        return VariableValueType.concept

    def add_criteria(self, relationship, value):
        self_copy = copy.deepcopy(self)
        self_copy.criteria.append((relationship, tuple))
        self_copy._hash = None
        return self_copy

    def add_adjective_concept(self, other_concept):
        self_copy = copy.deepcopy(self)
        for criteria in other_concept.criteria:
            if criteria[0] == "is_a":
                self_copy.criteria.append(("has_adjective", criteria[1]))
            else:
                self_copy.criteria.append(criteria)
        self_copy._hash = None
        return self_copy

    def entails(self, other_concept):
        for criteria in self.criteria:
            if criteria[0] == "is_a":
                for other_criteria in other_concept.criteria:
                    if other_criteria[0] == "is_a" and other_criteria[1] == criteria[1]:
                        return True

        return False
</code></pre></div></div>

<p>Then, fix up our <code class="language-plaintext highlighter-rouge">_create_v_1</code> predication to use <code class="language-plaintext highlighter-rouge">entails</code> instead of <code class="language-plaintext highlighter-rouge">==</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, names=["_create_v_1"])
def create_v_1_comm(context, state, e_introduced_binding, x_actor_binding, x_what_binding):
    def criteria(value):
        # Only allow creating conceptual files
        if isinstance(value, RichConcept) and value.entails(RichConcept("file")):
            return True

        else:
            context.report_error(["cantDo", "create", x_what_binding.variable.name])

    def unbound_what():
        context.report_error(["cantDo", "create", x_what_binding.variable.name])

    for success_state in individual_style_predication_1(context,
                                                        state,
                                                        x_what_binding,
                                                        criteria,
                                                        unbound_what,
                                                        ["cantXYTogether", "create", x_what_binding.variable.name]):
        object_to_create_binding = success_state.get_binding(x_what_binding.variable.name)
        operation = CreateOperation(object_to_create_binding, "newfile")
        yield success_state.apply_operations([operation])
</code></pre></div></div>

<p>Now if we run our test:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? create a text file
Done!
</code></pre></div></div>

<h3 id="other-referring-expressions">Other Referring Expressions</h3>
<p>Let’s go back to our example phrases from the beginning:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create a file
create a text file
create a test file containing "Hello World"
create a test file containing "Hello World" with read-only permissions
etc.
</code></pre></div></div>

<p>We got through the first 2. Hopefully, now you can see how the others are simply adding more and more criteria onto the <code class="language-plaintext highlighter-rouge">Concept</code>object and then implementing them when it is time to do the file creation.</p>

<p>Because we’ve done a lot in this section, here is all the new code we had to write:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, names=["_file_n_of"])
def file_n_of_concept(context, state, x_binding, i_binding):
    def bound_variable(value):
        if isinstance(value, RichConcept) and value == RichConcept("file"):
            return True
        else:
            context.report_error(["valueIsNotX", value, x_binding.variable.name])
            return False

    def unbound_variable():
        yield RichConcept("file")

    yield from combinatorial_predication_1(context,
                                           state,
                                           x_binding,
                                           bound_variable,
                                           unbound_variable)
                                           
                                           
@Predication(vocabulary, names=["_text_n_of"])
def text_n_of_concept(context, state, x_binding, i_binding):
    def bound_variable(value):
        if isinstance(value, RichConcept) and value == RichConcept("text"):
            return True
        else:
            context.report_error(["valueIsNotX", value, x_binding.variable.name])
            return False

    def unbound_variable():
        yield RichConcept("text")

    yield from combinatorial_predication_1(context,
                                           state,
                                           x_binding,
                                           bound_variable,
                                           unbound_variable)


@Predication(vocabulary,
             names=["compound"])
def compound_concept(context, state, e_introduced_binding, x_base_binding, x_modifier_binding):
    # Only support concepts
    # Both arguments will always be bound for compound
    # so we don't need to check unbound cases. Furthermore, the value will always be
    # a single value due to the way it is parsed, so we only need to check the first value
    if not isinstance(x_base_binding.value[0], RichConcept) or not isinstance(x_modifier_binding.value[0], RichConcept):
        context.report_error(["formNotUnderstood"])
        return

    compound_value = x_base_binding.value[0].add_adjective_concept(x_modifier_binding.value[0])
    yield state.set_x(x_base_binding.variable.name, (compound_value, ))
    

@Predication(vocabulary, names=["_create_v_1"])
def create_v_1_comm(context, state, e_introduced_binding, x_actor_binding, x_what_binding):
    def criteria(value):
        # Only allow creating conceptual files
        if isinstance(value, RichConcept) and value.entails(RichConcept("file")):
            return True

        else:
            context.report_error(["cantDo", "create", x_what_binding.variable.name])

    def unbound_what():
        context.report_error(["cantDo", "create", x_what_binding.variable.name])

    for success_state in individual_style_predication_1(context,
                                                        state,
                                                        x_what_binding,
                                                        criteria,
                                                        unbound_what,
                                                        ["cantXYTogether", "create", x_what_binding.variable.name]):
        object_to_create_binding = success_state.get_binding(x_what_binding.variable.name)
        operation = CreateOperation(object_to_create_binding, "newfile")
        yield success_state.apply_operations([operation])
        
        
class CreateOperation(object):
    def __init__(self, binding_to_create, file_name):
        self.binding_to_create = binding_to_create
        self.file_name = file_name

    def apply_to(self, state):
        state.file_system.create_item(self.binding_to_create, self.file_name)
        
        
class RichConcept:
    def __init__(self, is_a=None):
        self.criteria = [] if is_a is None else [("is_a", is_a)]
        self._hash = None

    def __repr__(self):
        return f"RichConcept({[x for x in self.criteria]})"

    # The only required property is that objects which compare equal have the same hash value
    # But: objects with the same hash aren't required to be equal
    # It must remain the same for the lifetime of the object
    def __hash__(self):
        if self._hash is None:
            self._hash = hash(tuple(self.criteria))

        return self._hash

    def __eq__(self, other):
        if isinstance(other, RichConcept) and self.__hash__() == other.__hash__():
            return True

    def value_type(self):
        return VariableValueType.concept

    def add_criteria(self, relationship, value):
        self_copy = copy.deepcopy(self)
        self_copy.criteria.append((relationship, tuple))
        self_copy._hash = None
        return self_copy

    def add_adjective_concept(self, other_concept):
        self_copy = copy.deepcopy(self)
        for criteria in other_concept.criteria:
            if criteria[0] == "is_a":
                self_copy.criteria.append(("has_adjective", criteria[1]))
            else:
                self_copy.criteria.append(criteria)
        self_copy._hash = None
        return self_copy

    def entails(self, other_concept):
        for criteria in self.criteria:
            if criteria[0] == "is_a":
                for other_criteria in other_concept.criteria:
                    if other_criteria[0] == "is_a" and other_criteria[1] == criteria[1]:
                        return True

        return False
        
class FileSysem:
    ...
    
    def get_file_type(self, concept):
        file_type = None
        for criteria in concept.criteria:
            if criteria[0] == "has_adjective":
                if file_type is None:
                    file_type = criteria[1]
                else:
                    # More than one type described, fail
                    return None

        return file_type
</code></pre></div></div>

<p>Last update: 2024-10-11 by Eric Zinda [<a href="https://github.com/EricZinda/Perplexity/edit/main/docs/pxHowTo/pxHowTo120ConceptsReferringExpressions.md">edit</a>]</p>

        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

<!--Scroll the navbar to the current page-->
<script type="text/javascript">
  let el = document.querySelector('.nav__list .active');
  if(el){
    el.scrollIntoView({block: "center", inline: "start"});
  }
</script>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/Perplexity/home/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Your Name. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/Perplexity/home/assets/js/main.min.js"></script>




<script src="/Perplexity/home/assets/js/lunr/lunr.min.js"></script>
<script src="/Perplexity/home/assets/js/lunr/lunr-store.js"></script>
<script src="/Perplexity/home/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
