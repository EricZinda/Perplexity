<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Perplexity</title>
<meta name="description" content="An amazing website.">


  <meta name="author" content="Your Name">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Perplexity">
<meta property="og:title" content="Perplexity">
<meta property="og:url" content="http://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo11State/">


  <meta property="og:description" content="An amazing website.">











  

  


<link rel="canonical" href="http://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo11State/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Your Name",
      "url": "http://blog.inductorsoftware.com/Perplexity/home/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/Perplexity/home/feed.xml" type="application/atom+xml" rel="alternate" title="Perplexity Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Perplexity/home/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--delphin_page wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/Perplexity/home/"><img src="/Perplexity/home/assets/images/Delph-In.png" alt="Perplexity"></a>
        
        <a class="site-title" href="/Perplexity/home/">
          Perplexity
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/Perplexity/home/devhowto/devhowtoOverview">Home</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Developer Tutorial Overview</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devhowto/devhowtoOverview/">Overview</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">MRS Conceptual</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devhowto/devhowtoMRS/">Minimal Recursion Semantics (MRS)</a></li>
          
            <li><a href="/Perplexity/home/devhowto/devhowtoWellFormedTree/">Well-Formed Trees</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">MRS Solver Conceptual</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devhowto/devhowtoMRSSolver/">Backtracking</a></li>
          
            <li><a href="/Perplexity/home/devhowto/devhowtoMRSSolverSets/">Representing 'Together'</a></li>
          
            <li><a href="/Perplexity/home/devhowto/devhowtoMRSSolverSolutionGroups/">Collective, Distributive, Cumulative</a></li>
          
            <li><a href="/Perplexity/home/devhowto/devhowtoMRSSolverSolutionGroupsAlgorithm/">Coll/Dist/Cuml Algorithm</a></li>
          
            <li><a href="/Perplexity/home/devhowto/devhowtoMRSSolverSolutionCombinations/">Combinations and Proper Responses</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Perplexity How-to</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo10Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo11State/" class="active">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo20ImplementAPredication/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo30InStylePredications/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo40LiftStylePredications/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo50EventPredications/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo70ActionVerbs/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo80QuantifiersAndDeterminers/">Overview</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h2 id="the-perplexity-state-object">The Perplexity State object</h2>
<p>Recall from the section on backtracking that Perplexity interpets a phrase by:</p>
<ol>
  <li>Converting the phrase to an MRS document</li>
  <li>Creating a well-formed tree from the MRS document</li>
  <li>Using backtracking to walk the tree and find values for the variables that make the MRS <code class="language-plaintext highlighter-rouge">true</code></li>
</ol>

<p>Using that approach, the phrase “A file is large.” creates this MRS and tree (among others):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ "a file is large"
  TOP: h0
  INDEX: e2 [ e SF: prop TENSE: pres MOOD: indicative PROG: - PERF: - ]
  RELS: &lt; [ _a_q&lt;0:1&gt; LBL: h4 ARG0: x3 [ x PERS: 3 NUM: sg IND: + ] RSTR: h5 BODY: h6 ]
          [ _file_n_of&lt;2:6&gt; LBL: h7 ARG0: x3 ARG1: i8 ]
          [ _large_a_1&lt;10:15&gt; LBL: h1 ARG0: e2 ARG1: x3 ] &gt;
  HCONS: &lt; h0 qeq h1 h5 qeq h7 &gt; ]


          ┌────── _file_n_of(x3,i8)
_a_q(x3,RSTR,BODY)
               └─ _large_a_1(e2,x3)
</code></pre></div></div>

<p>The solver calls each predication as it walks the tree</p>

<p>As each predication is called when walking the tree,
Let’s work through how to implement a class in Python by creating the class that will hold the state of the world: <code class="language-plaintext highlighter-rouge">State</code>. The current state of all MRS variables <em>and</em> the state of everything in the world will be accessed through this class. Because we want the state to be changed by predications, we will include an instance of it as the first argument when calling them.</p>

<p>The implementation of the <code class="language-plaintext highlighter-rouge">State</code> object can be very simple for now:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># "class" declares an object-oriented class in Python
# The parenthesis after the "State" class name surround
# the object the class derives from (object)
class State(object):

    # All class methods are indented under the
    # class and take "self" as their first argument.
    # "self" represents the class instance.

    # "__init__" is a special method name that
    # indicates the constructor, which is called to create
    # a new instance of the class. Arguments beyond "self"
    # get passed to the function when the instance is created
    def __init__(self, objects):
        # Class member variables are created by
        # simply assigning to them
        self.variables = dict()  # an empty dictionary

        # "objects" are passed to us as an argument
        # by whoever creates an instance of the class
        self.objects = objects


    # A standard "class method" is just a function definition,
    # indented properly, with "self" as the first argument

    # This is how predications will access the current value
    # of MRS variables like "x1" and "e1"
    def GetVariable(self, variable_name):
        # "get()" is one way to access a value in a dictionary.
        # The second argument, "None", is what to return if the
        # key doesn't exist.  "None" is a built-in value in Python
        # like "null"
        return self.variables.get(variable_name, None)

    # This is how predications will set the value
    # of an "x" variable
    def SetX(self, variable_name, item):
        # Make a *copy* of the entire object using the built-in Python
        # class called "copy", we pass it "self" so it copies this 
        # instance of the object
        new_state = copy.deepcopy(self)

        # Now we have a new "State" object with the same
        # world state that we can modify.
        
        # Dictionaries hold name/value pairs.
        # This is how you assign values to keys in dictionaries
        new_state.variables[variable_name] = item

        # "return" returns to the caller the new state with
        # that one variable set to a new value
        return new_state

    # This is an iterator (described above) that returns
    # all the objects in the world
    def AllIndividuals(self):
        for item in self.objects:
            yield item
</code></pre></div></div>
<p>Note that the <code class="language-plaintext highlighter-rouge">SetX()</code> method does not actually “set” a value in the <code class="language-plaintext highlighter-rouge">State</code> object, it creates a copy of the current <code class="language-plaintext highlighter-rouge">State</code> object and sets the value in <em>that</em>.  This ensures that variables set for a given <code class="language-plaintext highlighter-rouge">State</code> object are never changed (they are <em>immutable</em>). Immutability allows our solver to reuse the same state object multiple times when calling a predication in order to get fresh values bound to the variables. And this, in turn, is important to allow “backtracking” through possible solutions to the MRS. The fact that the <em>entire</em> state object (not just the variables) gets copied will be important when we get to verbs that change the world (e.g. deleting a file).</p>

<blockquote>
  <p>Note: There are much more efficient ways to isolate the data than copying the entire world, but we’re doing a copy to keep the code simple. For example, database engines like MySQL have transactions to isolate different parts of code from changes until they should be seen. We could improve our simple implementation by keeping a difference list and not copying the entire state for every copy, but for now we’ll keep it simple.</p>
</blockquote>

<p>Objects in the world can just be Python objects, although there are many other ways to represent them (the predication contract doesn’t care).</p>

<p>Because we will be copying the <code class="language-plaintext highlighter-rouge">State</code> object when changes are made, we will need some way to identify that, for example, the <code class="language-plaintext highlighter-rouge">foo</code> folder in one <code class="language-plaintext highlighter-rouge">State</code> object is the same <code class="language-plaintext highlighter-rouge">foo</code> folder in another <code class="language-plaintext highlighter-rouge">State</code> object. To do this, we’ll give each object a unique ID by creating a base class called <code class="language-plaintext highlighter-rouge">UniqueObject</code>. It will create a member variable called <code class="language-plaintext highlighter-rouge">unique_id</code> with a UUID (a globally unique number) in it. Then, we’ll derive all the objects in the system from it. That way, objects will always have a unique ID that follows them even if they are copied.</p>

<p>Here’s how we’ll create classes for each “type of thing” in our file system world:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>class UniqueObject(object):
    def __init__(self):
        self.unique_id = uuid.uuid4()


# Derive from UniqueObject and call
# its __init__ method from this __init__
# method so we get the unique ID created
class Folder(UniqueObject):
    def __init__(self, name):
        super().__init__()
        self.name = name
        

class File(UniqueObject):
    def __init__(self, name, size=None):
        super().__init__()
        self.name = name
        self.size = size
</code></pre></div></div>

<p>Creating a <code class="language-plaintext highlighter-rouge">State</code> object with the list of the objects from the example looks like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>state = State([Folder(name="Desktop"), 
               Folder(name="Documents"), 
               File(name="file1.txt"), 
               File(name="file2.txt")])
</code></pre></div></div>

<p>Note that an instance of the <code class="language-plaintext highlighter-rouge">State</code> object is created by calling it like a function. This really calls the <code class="language-plaintext highlighter-rouge">__init__</code> function of <code class="language-plaintext highlighter-rouge">State</code> and passes the supplied argument (a list) to <code class="language-plaintext highlighter-rouge">__init__</code>. Each object in the list is created just like <code class="language-plaintext highlighter-rouge">State</code> was: by calling it as a function. Note that arguments can be named like <code class="language-plaintext highlighter-rouge">name="Documents"</code> to clarify what is going on.</p>

<h3 id="todo-talk-about-driving-from-state-and-the-complexities-of-operations-etc">TODO: Talk about driving from State and the complexities of operations, etc.</h3>

<p>Last update: 2023-05-13 by EricZinda [<a href="https://github.com/EricZinda/Perplexity/edit/main/docs/pxHowTo/pxHowTo11State.md">edit</a>]</p>

        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

<!--Scroll the navbar to the current page-->
<script type="text/javascript">
  let el = document.querySelector('.nav__list .active');
  if(el){
    el.scrollIntoView({block: "center", inline: "start"});
  }
</script>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/Perplexity/home/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Your Name. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/Perplexity/home/assets/js/main.min.js"></script>




<script src="/Perplexity/home/assets/js/lunr/lunr.min.js"></script>
<script src="/Perplexity/home/assets/js/lunr/lunr-store.js"></script>
<script src="/Perplexity/home/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
