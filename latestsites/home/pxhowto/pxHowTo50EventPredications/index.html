<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Perplexity</title>
<meta name="description" content="An amazing website.">


  <meta name="author" content="Your Name">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Perplexity">
<meta property="og:title" content="Perplexity">
<meta property="og:url" content="http://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo50EventPredications/">


  <meta property="og:description" content="An amazing website.">











  

  


<link rel="canonical" href="http://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo50EventPredications/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Your Name",
      "url": "http://blog.inductorsoftware.com/Perplexity/home/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/Perplexity/home/feed.xml" type="application/atom+xml" rel="alternate" title="Perplexity Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Perplexity/home/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--delphin_page wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/Perplexity/home/"><img src="/Perplexity/home/assets/images/Delph-In.png" alt="Perplexity"></a>
        
        <a class="site-title" href="/Perplexity/home/">
          Perplexity
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/Perplexity/home/devhowto/devhowtoOverview">Home</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Developer Tutorial Overview</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devOverview/">Overview</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">MRS Conceptual</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/mrscon/devhowtoMRS/">Minimal Recursion Semantics (MRS)</a></li>
          
            <li><a href="/Perplexity/home/mrscon/devhowto0020WellFormedTree/">Well-Formed Trees</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">MRS Solver Conceptual</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devcon/devcon0010MRSSolver/">Backtracking</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0020MRSSolverSets/">Representing 'Together'</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0030MRSSolverSolutionGroups/">Collective, Distributive, Cumulative</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0040MRSSolverSolutionGroupsAlgorithm/">Coll/Dist/Cuml Algorithm</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0050MRSSolverSolutionCombinations/">Combinations and Proper Responses</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0060WhichParseAndTree/">Choosing a Parse and Tree</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0070SentenceForce/">Sentence Types</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0080ErrorsChoosingWhichFailure/">Choosing a Failure</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Perplexity Internals</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/pxint/pxint0010PredicationContract/">The Predication Contract</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0020PythonBasics/">State and Python Basics</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0030ImplementPredication/">Implementing a Predication</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0040BuildSolver/">Initial Solver</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0050Conjunctions/">Solving Conjunctions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0060ScopalArguments/">Soliving Scopal Arguments</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0070GenerateMRSAndTrees/">Generating MRS and Trees</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0071WhichParseAndTree/">Choosing a Parse and Tree</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0080SimplePropositions/">Propositions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0090SimpleQuestions/">Questions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0100SimpleCommands/">Commands</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0105ErrorsChoosingWhichFailure/">Choosing a Failure</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0110ErrorsReportingAFailure/">Naive Failures</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0120ErrorsConceptualFailures/">Words in Failures</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0130ErrorsRobustFailure/">Robust Failures</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Using Perplexity</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo10Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo20ImplementAPredication/">Implementing a Predication</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo30InStylePredications/">In-Style Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo40LiftStylePredications/">Lift-Style Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo50EventPredications/" class="active">Event Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo70ActionVerbs/">Verb Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo80QuantifiersAndDeterminers/">Quantifiers and Determiners</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h2 id="predications-with-event-variables">Predications with Event Variables</h2>
<p>So far, we have been conveniently ignoring event variables (variables that start with “e”). Where instance (<code class="language-plaintext highlighter-rouge">x</code>) variables contain a single set for any solution, event (<code class="language-plaintext highlighter-rouge">e</code>) variables are designed to build up a structure. They allow words like “very” and “slowly” to modify other words.</p>

<p>For example, we’ve been talking about a <code class="language-plaintext highlighter-rouge">_large_a_1(e2,x3), _file_n_of(x3)</code> and have ignored what the event variable <code class="language-plaintext highlighter-rouge">e2</code> is for. We can’t do this if we are trying to find a <code class="language-plaintext highlighter-rouge">_very_x_deg(e2, e1), _large_a_1(e1,x3), _file_n_of(x3)</code>.</p>

<p>In an MRS, any predication except a quantifier is said to “introduce” its first argument. If you look closely, you’ll see that every variable is only “introduced” by one predication in a given MRS – only one predication has a given variable as its first argument.  So, in a sense, that variable <em>represents</em> that predication.  If a predication like <code class="language-plaintext highlighter-rouge">_large_a_1(e2,x3)</code> introduces event variable <code class="language-plaintext highlighter-rouge">e2</code>, it does so to provide a place for other predications to hang modifiers.</p>

<p>For example, to represent something that is “very large”, the word “very” needs to be able to attach its “veryness” to “large”. For “very very large”, a chain is needed where the first “very” modifies the second, which modifies “large”. This is all done with events, and it happens like this because human languages allow all kinds of recursive constructions. DELPH-IN needed a way to model the behavior.</p>

<p>Here are the predications generated for: “very large” and “very very large”. The comma (“,”) is being used to indicate a conjunction (i.e. “and”):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Very large
_very_x_deg(e2, e1), _large_a_1(e1,x3)

# Very very large
_very_x_deg(e3, e2), _very_x_deg(e2, e1), _large_a_1(e1,x3)
</code></pre></div></div>

<p>You can see that in “very large”, <code class="language-plaintext highlighter-rouge">_very_x_deg</code> takes the event variable <em>introduced by</em> <code class="language-plaintext highlighter-rouge">_large_a_1</code> as an argument. The job of <code class="language-plaintext highlighter-rouge">_very_x_deg</code> is to put something in the event that <code class="language-plaintext highlighter-rouge">_large_a_1</code> can look for so that its behavior can be modified to be “very large”.</p>

<p><code class="language-plaintext highlighter-rouge">_very_x_deg</code> also introduces <em>its own</em> event variable that other predications can modify as in “very very large”. The first “very” modifies the event variable introduced by the second “very”, etc.</p>

<p>This means, first, that we need a mechanism for handling event variables and, second, that our implementation of <code class="language-plaintext highlighter-rouge">_large_a_1</code> needs to be modified to pay attention to modifications to its event.</p>

<p>Since event variables need to be able to capture what could be a large buildup of modifications in a given sentence, we’ll internally use a dictionary for them. The <code class="language-plaintext highlighter-rouge">State</code> object passed to every predication has an <code class="language-plaintext highlighter-rouge">add_to_e()</code> method to allow predications to build up information on event variables.  <code class="language-plaintext highlighter-rouge">x</code> variables have a value that is a single set, while <code class="language-plaintext highlighter-rouge">e</code> variables are a dictionary that builds up over time. So, <code class="language-plaintext highlighter-rouge">add_to_e()</code> has arguments that indicate what information to add to the event. However, just like <code class="language-plaintext highlighter-rouge">set_x()</code>,  <code class="language-plaintext highlighter-rouge">add_to_e()</code> returns a new <code class="language-plaintext highlighter-rouge">state</code> that must be yielded to indicate success. The <code class="language-plaintext highlighter-rouge">State</code> object is still immutable.</p>

<p>The <code class="language-plaintext highlighter-rouge">add_to_e()</code> method looks like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def add_to_e(self, event_name, key, value):
    ...
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">add_to_e()</code> adds the key/value pair it is given to a dictionary that represents the event state and returns a new <code class="language-plaintext highlighter-rouge">State</code> object, just like <code class="language-plaintext highlighter-rouge">set_x()</code> does. But, unlike <code class="language-plaintext highlighter-rouge">set_x()</code>, it adds to whatever was in the event variable before instead of replacing it. This allows information to get built up in the event.</p>

<p>Now, using the helpers from the previous sections and the new <code class="language-plaintext highlighter-rouge">add_to_e()</code> method, let’s create a <code class="language-plaintext highlighter-rouge">_very_x_deg</code> predication along with a <code class="language-plaintext highlighter-rouge">_large_a_1</code> predication that pays attention to modifications to its event.</p>

<p>Let’s start with <code class="language-plaintext highlighter-rouge">very_x_deg</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, names=["_very_x_deg"])
def very_x_deg(state, e_introduced_binding, e_target_binding):
    # We'll interpret every "very" as meaning "one order of magnitude larger"
    yield state.add_to_e(e_target_binding.variable.name, 
                         "DegreeMultiplier", 
                         {"Value": 10, 
                          "Originator": execution_context().current_predication_index()})
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">very_x_deg()</code> doesn’t have any <code class="language-plaintext highlighter-rouge">x</code> variables, so we don’t have to worry about if they are bound or unbound. Event variables always exist. Predications like this simply have to add information to the <code class="language-plaintext highlighter-rouge">e</code> variable they are modifying. Recall that the first argument (in this case, <code class="language-plaintext highlighter-rouge">e_introduced_binding</code>) represents <em>this</em> predication, so the variable being modified is the second one: <code class="language-plaintext highlighter-rouge">e_target_binding</code>.</p>

<p>It really doesn’t matter <em>what</em> the predication adds to <code class="language-plaintext highlighter-rouge">e_target_binding</code> as long as the predications that consume it know what to look for. It is application specific. However, the system will look for the <code class="language-plaintext highlighter-rouge">Originator: execution_context().current_predication_index()</code> field and use it to produce nice errors if it exists.</p>

<p>So, we’ve chosen to use the key <code class="language-plaintext highlighter-rouge">"DegreeMultiplier"</code> in the event as a name for the information provided by <code class="language-plaintext highlighter-rouge">very_x_deg</code>, and added a dictionary value for it that indicates to what degree something should be increased using <code class="language-plaintext highlighter-rouge">"Value": 10</code>.</p>

<p>We can now build a helper that knows about the names we’ve chosen so that any predication that understands “very” can use it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># This is a helper function that any predication that can
# be "very'd" can use to understand just how "very'd" it is
def degree_multiplier_from_event(state, e_introduced_binding):
    # if a "very" is modifying this event, use that value
    # otherwise, return 1
    if e_introduced_binding.value is None or \
            "DegreeMultiplier" not in e_introduced_binding.value:
        degree_multiplier = 1

    else:
        degree_multiplier = e_introduced_binding.value["DegreeMultiplier"]["Value"]

    return degree_multiplier
</code></pre></div></div>

<p>The helper function gets passed an event variable and looks for the information that <code class="language-plaintext highlighter-rouge">very_x_deg</code> adds to it. If found, it turns it. Otherwise, it just returns 1. Now, any predication can multiply numbers by this value.  Here’s an example of <code class="language-plaintext highlighter-rouge">large_a_1</code> using it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, names=["_large_a_1"])
def large_a_1(state, e_introduced_binding, x_target_binding):
    # See if any modifiers have changed *how* large we should be
    degree_multiplier = degree_multiplier_from_event(state, e_introduced_binding)

    def bound_variable(value):
        if hasattr(value, 'size') and value.size &gt; degree_multiplier * 1000000:
            return True

        else:
            report_error(["adjectiveDoesntApply", "large", x_target_binding.variable.name])
            return False

    def unbound_variable():
        for item in state.all_individuals():
            if bound_variable(item):
                yield item

    yield from combinatorial_style_predication_1(state, x_target_binding, bound_variable, unbound_variable)
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">large_a_1</code> uses the same <code class="language-plaintext highlighter-rouge">combinatorial_style_predication_1()</code> helper that “file” did from a previous section. It tests if something is large by seeing if it has a <code class="language-plaintext highlighter-rouge">size</code> property and, if so, seeing if the <code class="language-plaintext highlighter-rouge">size</code> is 1,000,000 multiplied by however many “very’s” the user said. Obviously, this only makes sense if we are talking about files, the implementation of <code class="language-plaintext highlighter-rouge">large_a_1</code>, like every predication, is application specific.</p>

<p>Note that if <code class="language-plaintext highlighter-rouge">large_a_1</code> is called with an unbound variable, it looks through every object in the system and only returns the ones that are “large” (or “very large”) by calling the same function used to check bound variables.</p>

<h2 id="declaring-use-of-event-information">Declaring Use of Event Information</h2>
<p>There is a problem, however. This doesn’t work yet. If the user says “a file is very large” the system will respond with:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>I don't understand the way you are using 'very' with 'large'
</code></pre></div></div>

<p>This is because Perplexity is designed to make sure it understands <em>every</em> word in a sentence so that users gain confidence that they truly are understood and that the system isn’t just doing “keyword picking”. One way it does this is by ensuring that any information added to an event is actually consumed by another predication in the phrase. If not, it replies with that error.</p>

<p>Since we have implemented “very” with “large”, the fix is simple: we just need to add information to the <code class="language-plaintext highlighter-rouge">@Predication</code> declaration, like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary, 
             names=["_large_a_1"], 
             handles=[("DegreeMultiplier", EventOption.optional)])
def large_a_1(state, e_introduced_binding, x_target_binding):

    ...
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">handles=[]</code> clause lists out all of the keys that the predication knows how to process in its introduced event. In this case, we have also added <code class="language-plaintext highlighter-rouge">EventOption.optional</code> to say that large doesn’t <em>require</em> “very”, but understands it if it exists. Now it will properly process the phrase.</p>

<blockquote>
  <p>Comprehensive source for the completed tutorial is available <a href="https://github.com/EricZinda/Perplexity">here</a>.</p>
</blockquote>

<p>Last update: 2023-05-13 by EricZinda [<a href="https://github.com/EricZinda/Perplexity/edit/main/docs/pxHowTo/pxHowTo50EventPredications.md">edit</a>]</p>

        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

<!--Scroll the navbar to the current page-->
<script type="text/javascript">
  let el = document.querySelector('.nav__list .active');
  if(el){
    el.scrollIntoView({block: "center", inline: "start"});
  }
</script>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/Perplexity/home/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Your Name. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/Perplexity/home/assets/js/main.min.js"></script>




<script src="/Perplexity/home/assets/js/lunr/lunr.min.js"></script>
<script src="/Perplexity/home/assets/js/lunr/lunr-store.js"></script>
<script src="/Perplexity/home/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
