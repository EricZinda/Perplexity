<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Perplexity</title>
<meta name="description" content="An amazing website.">


  <meta name="author" content="Your Name">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Perplexity">
<meta property="og:title" content="Perplexity">
<meta property="og:url" content="http://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo105GlobalCriteria/">


  <meta property="og:description" content="An amazing website.">











  

  


<link rel="canonical" href="http://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo105GlobalCriteria/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Your Name",
      "url": "http://blog.inductorsoftware.com/Perplexity/home/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/Perplexity/home/feed.xml" type="application/atom+xml" rel="alternate" title="Perplexity Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Perplexity/home/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--delphin_page wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/Perplexity/home/"><img src="/Perplexity/home/assets/images/Delph-In.png" alt="Perplexity"></a>
        
        <a class="site-title" href="/Perplexity/home/">
          Perplexity
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/Perplexity/home/devOverview">Home</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Developer Tutorial Overview</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devOverview/">Overview</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">MRS Conceptual</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/mrscon/devhowto0010MRS/">Minimal Recursion Semantics (MRS)</a></li>
          
            <li><a href="/Perplexity/home/mrscon/devhowto0020WellFormedTree/">Well-Formed Trees</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">MRS Solver Conceptual</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devcon/devcon0000Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0010MRSSolver/">Solving an MRS</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0020MRSSolverSets/">Representing 'Together'</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0030MRSSolverSolutionGroups/">Collective, Distributive, Cumulative</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0060WhichParseAndTree/">Choosing a Parse and Tree</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0070SentenceForce/">Sentence Types</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0080ErrorsChoosingWhichFailure/">Choosing a Failure</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0040MRSSolverSolutionGroupsAlgorithm/">A. Implementing Solution Groups</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0050MRSSolverSolutionCombinations/">B. Optimizing Solution Groups</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Using Perplexity</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo010Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxHowTo/pxHowTo012Install/">Installing Perplexity</a></li>
          
            <li><a href="/Perplexity/home/pxHowTo/pxHowTo014HelloWorld/">Hello World</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo020ImplementAPredication/">Implementing a Predication</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo022Testing/">Testing</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo030InStylePredications/">In-Style Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo040LiftStylePredications/">Lift-Style Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo050EventPredications/">Event Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo070ActionVerbs/">Verb Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo082State/">Custom State</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo085Place/">Representing Places</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo090Prepositions/">Directional Propositions</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo100NonlogicalMeaning/">Solution Group Handlers and Non-logical Meaning</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo105GlobalCriteria/" class="active">Solution Group Handlers and Global Criteria</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo110HandlingTenses/">Handling Tenses</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo120ConceptsReferringExpressions/">Conceptual References</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo080QuantifiersAndDeterminers/">Quantifiers and Determiners</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo130OpenClassWords/">Centralizing Nouns/Adjectives</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo025SStrings/">A. Generating English with S-strings</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Perplexity Internals</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/pxint/pxint0000Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0010PredicationContract/">The Predication Contract</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0020PythonBasics/">State and Python Basics</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0030ImplementPredication/">Implementing a Predication</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0040BuildSolver/">Initial Solver</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0050Conjunctions/">Solving Conjunctions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0060ScopalArguments/">Solving Scopal Arguments</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0080SimplePropositions/">Propositions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0090SimpleQuestions/">Questions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0100SimpleCommands/">Commands</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0105ErrorsChoosingWhichFailure/">Choosing a Failure</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0110ErrorsReportingAFailure/">Naive Failure Text</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0120ErrorsConceptualFailures/">English Variable Domains</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0070GenerateMRSAndTrees/">Generating MRS and Trees</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0071WhichParseAndTree/">Choosing a Parse and Tree</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0230Summary/">Summary</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint03000PythonDecorators/">A. Python Decorators</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h2 id="solution-group-handlers-and-global-criteria">Solution Group Handlers and Global Criteria</h2>
<p>In the <a href="https://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo100NonlogicalMeaning">previous section</a> we implemented variations of “Do you have commands?” by implementing a custom <em>solution group handler</em>, but we didn’t complete it.  Since there are only two commands, we should do a better job on the following phrases that succeed, and shouldn’t:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? Do you have 3 commands?
You can use the following commands: copy and go

? Do you have many commands?
You can use the following commands: copy and go

? Do you have several commands?
You can use the following commands: copy and go

? Do you have the command?
You can use the following commands: copy and go
</code></pre></div></div>

<p>All of these phrases are using words like “several” or “3” which quantify how many of something the speaker is interested in. The last uses “the” which implies there is just one that is so obvious the system should know which one it is. When we implement a solution group handler we take over responsibility for doing the counting, and we’re not yet doing that.</p>

<h3 id="inspecting-global-criteria">Inspecting Global Criteria</h3>
<p>When a speaker uses a phrase that constrains the solution group using numeric constraints or “the”, these constraints are tracked with the arguments in the solution group handler and can be inspected:</p>

<p>Let’s change our <code class="language-plaintext highlighter-rouge">have_v_1</code> solution group handler to output these constraints so we can see them:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary,
             names=["solution_group__have_v_1"],
             handles_interpretation=_have_v_1_concept)
def _have_v_1_group(context, state_list, e_introduced_binding_list, x_actor_variable_group, x_target_variable_group):
    print(f"x_actor_binding constraints: {x_actor_variable_group.variable_constraints}")
    print(f"x_target_binding constraints: {x_target_variable_group.variable_constraints}")
    yield [state_list[0].record_operations([RespondOperation("You can use the following commands: copy and go")])]
</code></pre></div></div>

<p>And then run it:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? do you have commands
x_actor_binding constraints: {x3: min=1, max=inf, global=None, required_values=None, pred=pronoun_q(x3)}
x_target_binding constraints: {x8: min=2, max=inf, global=None, required_values=None, pred=udef_q(x8)}
You can use the following commands: copy and go

? /show
User Input: do you have commands
1 Parses

***** CHOSEN Parse #0:
Sentence Force: ques
[ "do you have commands"
  TOP: h0
  INDEX: e2 [ e SF: ques TENSE: pres MOOD: indicative PROG: - PERF: - ]
  RELS: &lt; [ pron&lt;3:6&gt; LBL: h4 ARG0: x3 [ x PERS: 2 IND: + PT: std ] ]
          [ pronoun_q&lt;3:6&gt; LBL: h5 ARG0: x3 RSTR: h6 BODY: h7 ]
          [ _have_v_1&lt;7:11&gt; LBL: h1 ARG0: e2 ARG1: x3 ARG2: x8 [ x PERS: 3 NUM: pl IND: + ] ]
          [ udef_q&lt;12:20&gt; LBL: h9 ARG0: x8 RSTR: h10 BODY: h11 ]
          [ _command_n_1&lt;12:20&gt; LBL: h12 ARG0: x8 ] &gt;
  HCONS: &lt; h0 qeq h1 h6 qeq h4 h10 qeq h12 &gt; ]

-- CHOSEN Parse #0, CHOSEN Tree #0: 

               ┌────── pron(x3)
pronoun_q(x3,RSTR,BODY)            ┌────── _command_n_1(x8)
                    └─ udef_q(x8,RSTR,BODY)
                                        └─ _have_v_1(e2,x3,x8)
</code></pre></div></div>

<p>You can see from the output that the constraints on <code class="language-plaintext highlighter-rouge">x3</code>, which is where “you” is represented, are between 1 and <code class="language-plaintext highlighter-rouge">inf</code> (infinity):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x_actor_binding constraints: {x3: min=1, max=inf, global=None, required_values=None, pred=pronoun_q(x3)}
</code></pre></div></div>

<p>That’s because, if you look at the MRS, <code class="language-plaintext highlighter-rouge">x3</code> doesn’t indicate one way or the other if “you” is plural or singular “you”, and there aren’t any other predications that would constrain things.</p>

<p>For <code class="language-plaintext highlighter-rouge">x8</code> we get a constraint between 2 and infinity.  Looking at the MRS you can see that <code class="language-plaintext highlighter-rouge">x8</code> has the properties <code class="language-plaintext highlighter-rouge">[ x PERS: 3 NUM: pl IND: + ]</code> set in the <code class="language-plaintext highlighter-rouge">have_v_1</code> predication, which indicates plurality.  I.e. between 2 and infinity:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>x_target_binding constraints: {x8: min=2, max=inf, global=None, required_values=None, pred=udef_q(x8)}
</code></pre></div></div>

<p>Running this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? Do you have 3 commands
x_actor_binding constraints: {x3: min=1, max=inf, global=None, required_values=None, pred=pronoun_q(x3)}
x_target_binding constraints: {x8: min=3, max=3, global=None, required_values=None, pred=card(3)}
You can use the following commands: copy and go
</code></pre></div></div>

<p>Shows how, if the speaker says “3”, the constraints are set to a min and max of “3”.</p>

<p>Let’s try:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? Do you have the command?
x_actor_binding constraints: {x3: min=1, max=inf, global=None, required_values=None, pred=pronoun_q(x3)}
x_target_binding constraints: {x8: min=1, max=1, global=GlobalCriteria.all_rstr_meet_criteria, required_values=None, pred=_the_q(x8)}
You can use the following commands: copy and go
</code></pre></div></div>

<p>The word “the” means “the one and only” or “the 1 group” and so it has a min/max of 1 and it has <code class="language-plaintext highlighter-rouge">global=GlobalCriteria.all_rstr_meet_criteria</code>. <code class="language-plaintext highlighter-rouge">all_rstr_meet_criteria</code> is how “the 1 group” gets handled.  It means: all of the things that “the” refers to in its <code class="language-plaintext highlighter-rouge">RSTR</code> must be true of its <code class="language-plaintext highlighter-rouge">BODY</code>. Let’s look at the MRS tree to understand:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>               ┌────── pron(x3)
pronoun_q(x3,RSTR,BODY)            ┌────── _command_n_1(x8)
                    └─ _the_q(x8,RSTR,BODY)
                                        └─ _have_v_1(e2,x3,x8)
</code></pre></div></div>

<p>Since <code class="language-plaintext highlighter-rouge">all_rstr_meet_criteria</code> is set on <code class="language-plaintext highlighter-rouge">x8</code>, it is referring to the <code class="language-plaintext highlighter-rouge">RSTR</code> and <code class="language-plaintext highlighter-rouge">BODY</code> of: <code class="language-plaintext highlighter-rouge">_the_q(x8,RSTR,BODY)</code>.</p>

<p>The <code class="language-plaintext highlighter-rouge">RSTR</code> is simply <code class="language-plaintext highlighter-rouge">_command_n_1(x8)</code>, so <em>all</em> commands in the system are being referred to.  The <code class="language-plaintext highlighter-rouge">BODY</code> is set to <code class="language-plaintext highlighter-rouge">_have_v_1(e2,x3,x8)</code>.  So, as long as “you” have “all” the commands in the system, this should be true.</p>

<p>What about “The commands are copy”.  This would put “all commands” in the <code class="language-plaintext highlighter-rouge">RSTR</code> and “being copy” in the <code class="language-plaintext highlighter-rouge">BODY</code> which is certainly not true for all of them, so it should fail.</p>

<p>What about this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>? Do you have the 3 commands?
x_actor_binding constraints: {x3: min=1, max=inf, global=None, required_values=None, pred=pronoun_q(x3)}
x_target_binding constraints: {x8: min=3, max=3, global=GlobalCriteria.all_rstr_meet_criteria, required_values=None, pred=_the_q(x8)}
You can use the following commands: copy and go

? /show
...
                                               ┌── _command_n_1(x8)
                                   ┌────── and(0,1)
               ┌────── pron(x3)    │             │
               │                   │             └ card(3,e14,x8)
pronoun_q(x3,RSTR,BODY)            │
                    └─ _the_q(x8,RSTR,BODY)
                                        └─ _have_v_1(e2,x3,x8)
</code></pre></div></div>

<p>This one says <code class="language-plaintext highlighter-rouge">x8</code> which is <code class="language-plaintext highlighter-rouge">_the_q(x8,RSTR,BODY)</code> must have 3 different values in it. And: all commands in the system should be true of the body. While it is certainly true that the system “has” all the commands, it is not true that there are 3 of them, so this is false.</p>

<p>Normally, Perplexity handles checking these constraints and doesn’t consider a solution group to be valid unless it meets them all. But when you build a solution group handler, you are telling the system: I am doing something custom with the solution group and thus I will also be responsible for making sure the constraints are met on it.</p>

<h3 id="different-interpretations-of-constraints">Different Interpretations of Constraints</h3>
<p>To determine if constraints are met, you first need to make a decision about what the speaker meant by the phrase. This isn’t always obvious. Consider the following phrases:</p>

<blockquote>
  <p>Do you have more than 2 chairs?</p>
</blockquote>

<p>If Aiden walks into an office and is looking for a place to sit, he is probably asking about <em>instances</em> of chairs.</p>

<p>If Aiden walks into a furniture store wanting to buy a chair, he is probably asking about <em>types</em> of chairs … unless he’s been talking the salesman about a particular type and is wondering how many they have in stock.</p>

<blockquote>
  <p>Do you have the steak?</p>
</blockquote>

<p>If Elie is talking to a waiter and there is often a steak special, she probably means “is the <em>conceptual type</em> of steak you usually have on the menu today?”.</p>

<p>If instead she is talking to her friend about a particular steak he bought, she probably means the <em>instance</em>.</p>

<blockquote>
  <p>Do you have two menus?</p>
</blockquote>

<p>If Zahra is in a restaurant that has several types of menus, maybe for lunch and dinner, she might be referring to <em>types</em> of menus.</p>

<p>She could also mean “one menu for me and one for my Mom”.</p>

<p>What these all have in common is that hints about what the speaker means can be found in the <em>context</em>, or scenario, that is occurring. It is often not obvious which is meant, a priori. So, you’ll need to determine which is meant given your scenario. Note that you can also implement both as different <em>interpretations</em> and try each to see which works, or reorder them based on the current context.  You may also decide that the constraint doesn’t matter. If there are no steaks available in your vegetarian restaurant just about any question about a steak should be met with, “I’m so sorry, we don’t have those here.”</p>

<h3 id="the-concept_meets_constraint-helper">The <code class="language-plaintext highlighter-rouge">concept_meets_constraint</code> Helper</h3>
<p>Regardless of which you decide, you need to write the code to make sure the constraints are met.  As shown above, the constraints are available in the <code class="language-plaintext highlighter-rouge">variable_constraints</code> property of each variable group in your solution group handler. That code is repeated below:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary,
             names=["solution_group__have_v_1"],
             handles_interpretation=_have_v_1_concept)
def _have_v_1_group(context, state_list, e_introduced_binding_list, x_actor_variable_group, x_target_variable_group):
    print(f"x_actor_binding constraints: {x_actor_variable_group.variable_constraints}")
    print(f"x_target_binding constraints: {x_target_variable_group.variable_constraints}")
    ...
    
? do you have commands
x_actor_binding constraints: {x3: min=1, max=inf, global=None, required_values=None, pred=pronoun_q(x3)}
x_target_binding constraints: {x8: min=2, max=inf, global=None, required_values=None, pred=udef_q(x8)}
</code></pre></div></div>

<p>However, very often you’ll just need to decide if the intended meaning is about concepts or instances and want to see if the concepts and instances in the solution group match them. If your solution group is dealing with <em>concepts</em> in the variable (which is most commonly why you’d create a solution group), you can use a Perplexity function called <code class="language-plaintext highlighter-rouge">concept_meets_constraint</code>. This function checks a particular concept-valued variable to see if it meets the global constraints. Let’s go through the implementation of this function to see how it works.</p>

<p>The function assumes the variable in question contains <em>concepts</em> and requires that you give it some information about the concepts in the solution group, as well as some information about the world the phrase was uttered in. Let’s go through the incoming arguments first:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def concept_meets_constraint(context, 
                             tree_info, 
                             variable_constraints, 
                             concept_count, 
                             concept_in_scope_count, 
                             instance_count, 
                             check_concepts, 
                             variable):
    ...
</code></pre></div></div>

<p>The first two arguments are the <code class="language-plaintext highlighter-rouge">context</code> and <code class="language-plaintext highlighter-rouge">tree_info</code> from the solution group handler which can be retrieved like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary,
             names=["solution_group__have_v_1"],
             handles_interpretation=_have_v_1_concept)
def _have_v_1_group(context, state_list, e_introduced_binding_list, x_actor_variable_group, x_target_variable_group):
        success = concept_meets_constraint(context,
                                           state_list[0].get_binding("tree").value[0]
                                           ...
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">concept_count</code> refers to the number of different concepts that are in this variable in the solution group.  To gather the different concepts in a variable like <code class="language-plaintext highlighter-rouge">x_target</code>, we can use a Python <code class="language-plaintext highlighter-rouge">set</code> object like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def _have_v_1_group(context, state_list, e_introduced_binding_list, x_actor_variable_group, x_target_variable_group):
    target_concepts = set([x.value for x in x_target_variable_group.solution_values])
    target_concept_count = len(target_concepts)
</code></pre></div></div>

<p>We use a set because we want <em>unique</em> concepts. The solution group may have several solutions that have the same concept and we only want to count that as a single concept.</p>

<p>The next argument is <code class="language-plaintext highlighter-rouge">concept_in_scope_count</code>. In Perplexity, “in-scope concepts” are how you indicate how many of the set of concepts you just gathered are “in-scope”, meaning that there is a particular concept that it would be appropriate to say “the” with.  Some examples:</p>

<ul>
  <li>“Please give me the menu”: there is “one menu” that they are obviously referring to</li>
  <li>“Where are the girls?”: there are a particular set of girls that we are talking about</li>
  <li>“Do you still have the chair”</li>
</ul>

<p>etc.</p>

<p>How you decide which concepts make sense to be “in-scope” is up to you, but is obviously very context dependent. If you have a function that determines it based on the state of the world, you’d do something like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    concept_in_scope_count = 0
    for concept in target_concepts:
        if in_scope(context, state, concept):
            concept_in_scope_count += 1
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">instance_count</code> refers to how many <em>instances</em> of those concepts are in the world.  This is used for phrases like “Do you have 2 chairs?” interpreted as the user referring to instances (not types of) chairs.  So, you need a way to find out how many instances there are for all the concepts in the solution group.  Below we use an “.instances()” method of <code class="language-plaintext highlighter-rouge">Concept</code> which you’ll need to implement to generate the instances based on how you’ve implemented your <code class="language-plaintext highlighter-rouge">Concept</code> object:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    instances = []
    for concept in concepts:
        this_concept_instances = list(concept.instances(context, state))
        # If we are dealing with instances and one of the concepts generates 
        # zero, we don't want to just count the others
        # and succeed.  e.g. "I have two ice creams and bowls" should not 
        # succeed if there are no bowls
        if len(this_concept_instances) == 0:
            instances = None
            break

        instances += this_concept_instances
    if instances is None:
        # We can fail immediately
        return
    else:
        instance_count = len(instances)
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">check_concepts</code> is <code class="language-plaintext highlighter-rouge">True</code> if you are interpreting the criteria as counting concepts, otherwise instances are checked.</p>

<p><code class="language-plaintext highlighter-rouge">variable</code> is the final argument, and is simply the name of the MRS variable being checked.</p>

<p>Now that we’ve seen all the arguments, here they are being used to check for an interpretation where the speaker is asking about having the concept of, not instances of, something. For example, “Do you have specials?”, referring to the existence of specials, not how many are left of them. Since the implementation of most of this depends on your implementation, it isn’t a library function. However, it will be the same for most of your predications so you can create one of your own:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>@Predication(vocabulary,
             names=["solution_group__have_v_1"],
             handles_interpretation=_have_v_1_concept)
def _have_v_1_group(context, state_list, e_introduced_binding_list, x_actor_variable_group, x_target_variable_group):
    # Count the concepts
    target_concepts = set([x.value for x in x_target_variable_group.solution_values])
    target_concept_count = len(target_concepts)
    
    # Count the in-scope concepts
    concept_in_scope_count = 0
    for concept in target_concepts:
        if in_scope(context, state, concept):
            concept_in_scope_count += 1

    # Count the instances
    instances = []
    for concept in concepts:
        this_concept_instances = list(concept.instances(context, state))
        # If we are dealing with instances and one of the concepts generates 
        # zero, we don't want to just count the others
        # and succeed.  e.g. "I have two ice creams and bowls" should not 
        # succeed if there are no bowls
        if len(this_concept_instances) == 0:
            instances = None
            break

        instances += this_concept_instances
        
    if instances is None:
        # We can fail immediately
        return
    else:
        instance_count = len(instances)
    
    success = concept_meets_constraint(context=context,
                                       tree_info=state_list[0].get_binding("tree").value[0],
                                       variable_constraints=x_target_variable_group.variable_constraints,
                                       concept_count=target_concept_count,
                                       concept_in_scope_count=concept_in_scope_count,
                                       instance_count=instance_count,
                                       check_concepts=True,
                                       variable=x_what_variable_group.solution_values[0].variable.name)
    
    if success:
        # Your custom code here
</code></pre></div></div>

<h3 id="the-concept_meets_constraint-implementation">The <code class="language-plaintext highlighter-rouge">concept_meets_constraint</code> Implementation</h3>
<p>Now let’s go through how <code class="language-plaintext highlighter-rouge">concept_meets_constraint</code> uses these arguments to check if a solution group meets its constraints. It is useful to understand since you may need different logic for some of your predications. This function just implements the most common behavior.</p>

<p>First, default <code class="language-plaintext highlighter-rouge">min</code> and <code class="language-plaintext highlighter-rouge">max</code> constraints are filled in the the variable doesn’t have them. Then, it branches based on whether the caller asked to check concepts or instances.  First let’s do concepts.  The comments in the code describe what is happening:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def concept_meets_constraint(context,
                             tree_info,
                             variable_constraints,
                             concept_count,
                             concept_in_scope_count,
                             instance_count,
                             check_concepts,
                             variable):
    min_size = variable_constraints.min_size if variable_constraints is not None else 1
    max_size = variable_constraints.max_size if variable_constraints is not None else float(inf)
    
    if check_concepts:
        # We are making sure the constraints succeed against the concept count
        if variable_constraints is not None and variable_constraints.global_criteria == perplexity.plurals.GlobalCriteria.all_rstr_meet_criteria:
            # If the user says "the specials" or "the 2 menus" they are putting a criteria
            # on the *concept*, not the instances. I.e. there should be
            # 2 *types* of menus in scope. Examples:
            #
            # "Do you have the 2 menus?" (interpreted as meaning classes of menus)
            # "Are the 2 specials good?" (ditto)
            # "Do you have the steak?" (ditto)
            #
            # Furthermore, because they said "the", they are referring to a "in-scope concept", 
            # i.e. "the menu", not just any old menu. It is a special one. This is modelled as 
            # having the concept be "in scope". The generic type, "menu" still exists, but is
            # a type that is out of scope. If they said "What is generally on a menu?" they'd
            # be referring to that generic type.
            check_count = concept_in_scope_count

        else:
            # The user didn't say "the", so the concept doesn't need to be "in-scope" and so
            # they are talking about the generic type (as described above). Examples:
            #
            # "How many specials do you have?" (meaning classes of specials)
            # "Are 2 specials available" (ditto)
            # "What chairs do you have?" (ditto)
            # "specials are cheaper" (ditto)
            # "Are specials available?" (ditto)
            # "Can I get a table?" (ditto)
            check_count = concept_count

        if check_count == 0:
            introducing_predication = perplexity.tree.find_quantifier_from_variable(tree_info["Tree"], variable)
            context.report_error(["phase2ZeroCount", ["AtPredication", introducing_predication.args[2], variable]], force=True, phase=2)
            return False

        if check_count &lt; min_size:
            context.report_error(["phase2LessThan", ["AfterFullPhrase", variable], min_size], force=True, phase=2)
            return False

        elif check_count &gt; max_size:
            context.report_error(["phase2MoreThanN", ["AfterFullPhrase", variable], max_size], force=True, phase=2)
            return False

        return True
    
    ...
</code></pre></div></div>

<p>The real work for checking concepts is to decide whether the word “the” has been used. This determines whether we check the “in-scope concept” count or just the “concept count”.  The rest of the code is just comparing the resulting number to the <code class="language-plaintext highlighter-rouge">min</code> and <code class="language-plaintext highlighter-rouge">max</code> sizes and reporting an error if it isn’t in range.</p>

<p>The second part of the function gets run when <code class="language-plaintext highlighter-rouge">check_concepts=False</code>. In this case, the speaker is talking about a concept, but the ultimate thing that needs to be manipulated is an instance.  E.g. to implement “I want a menu”, our code will need to find a menu and give it to the speaker.</p>

<p>Here again the only subtlety is dealing with “the” and making sure we interpret phrases like, “give me the two menus” properly. Even if they are ultimately wanting instances, “the two menus” will need to be checked to make sure that we actually do have two <em>types</em> of menu, so that we can then give them both.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>def concept_meets_constraint(context,
                             tree_info,
                             variable_constraints,
                             concept_count,
                             concept_in_scope_count,
                             instance_count,
                             check_concepts,
                             variable):
    
    ...
    
    else:
        # The user is talking about a concept, but, ultimately, our code will need to check if there are 
        # enough instances. Examples:
        #   "We want a menu" --&gt; "We want 1 instance of a menu concept"
        #   "We want a table" --&gt; "We want 1 instance of a table concept"
        #   "We want tables/menus" --&gt; "We want instances of the tables"
        #   "We want the menu(s)" --&gt; "We want an undefined number of instances of 
        #                             'the one and only table concept in scope'"
        #   "We want the specials" --&gt; "We want an undefined number of instances of 
        #                              'the (undefined number of) the special concepts in scope'"
        #
        # First, check to make sure we the system has the right number of "in scope" concepts if "the" is used,
        # as in "I'd like the 2 menus" (if there are a drink menu and a food menu)
        if variable_constraints is not None and variable_constraints.global_criteria == perplexity.plurals.GlobalCriteria.all_rstr_meet_criteria:
            check_count = concept_in_scope_count
            if check_count == 0:
                context.report_error(["conceptNotFound", variable], force=True, phase=2)
                return False

            if check_count &lt; min_size:
                context.report_error(["phase2LessThan", ["AfterFullPhrase", variable], min_size], force=True, phase=2)
                return False

            elif check_count &gt; max_size:
                context.report_error(["phase2MoreThanN", ["AfterFullPhrase", variable], max_size], force=True, phase=2)
                return False

        # Then, regardless of whether "the" was used, check to make sure there are enough instances to 
        # meet the criteria since that is what we are ultimately looking for
        check_count = instance_count
        if check_count == 0:
            context.report_error(["conceptNotFound", variable], force=True, phase=2)
            return False

        if check_count &lt; min_size:
            context.report_error(["phase2LessThan", ["AfterFullPhrase", variable], min_size], force=True, phase=2)
            return False

        # As long as the instances are &gt;= min_size, we are good because the caller is responsible
        # for limiting the number of instances being dealt with.
        # For example: "We'd like a table for 2". If there are 20 tables, the caller
        # is responsible for giving only 1
        return True
</code></pre></div></div>

<h3 id="actually-doing-something">Actually Doing Something</h3>
<p>The work to <em>actually do something</em> in the system was not covered above.  We walked through how process a phrase like “Give me a menu” by interpreting it as a “Conceptual” menu and building a solution group handler in the section on <a href="https://blog.inductorsoftware.com/Perplexity/home/pxhowto/pxHowTo100NonlogicalMeaning">implementing non-logical meaning</a>, and then checking global constraints in the description above. Once all that succeeds, you still need to <em>do the thing</em>.</p>

<p>How to do that is up to you.</p>

<blockquote>
  <p>Comprehensive source for the completed tutorial is available <a href="https://github.com/EricZinda/Perplexity/tree/main/samples/hello_world">here</a></p>
</blockquote>

<p>Last update: 2024-10-25 by Eric Zinda [<a href="https://github.com/EricZinda/Perplexity/edit/main/docs/pxHowTo/pxHowTo105GlobalCriteria.md">edit</a>]</p>

        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

<!--Scroll the navbar to the current page-->
<script type="text/javascript">
  let el = document.querySelector('.nav__list .active');
  if(el){
    el.scrollIntoView({block: "center", inline: "start"});
  }
</script>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/Perplexity/home/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Your Name. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/Perplexity/home/assets/js/main.min.js"></script>




<script src="/Perplexity/home/assets/js/lunr/lunr.min.js"></script>
<script src="/Perplexity/home/assets/js/lunr/lunr-store.js"></script>
<script src="/Perplexity/home/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
