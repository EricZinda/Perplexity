<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Perplexity</title>
<meta name="description" content="An amazing website.">


  <meta name="author" content="Your Name">
  


<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Perplexity">
<meta property="og:title" content="Perplexity">
<meta property="og:url" content="http://blog.inductorsoftware.com/Perplexity/home/devcon/devcon0080ErrorsChoosingWhichFailure/">


  <meta property="og:description" content="An amazing website.">











  

  


<link rel="canonical" href="http://blog.inductorsoftware.com/Perplexity/home/devcon/devcon0080ErrorsChoosingWhichFailure/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Your Name",
      "url": "http://blog.inductorsoftware.com/Perplexity/home/"
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/Perplexity/home/feed.xml" type="application/atom+xml" rel="alternate" title="Perplexity Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/Perplexity/home/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--delphin_page wide">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/Perplexity/home/"><img src="/Perplexity/home/assets/images/Delph-In.png" alt="Perplexity"></a>
        
        <a class="site-title" href="/Perplexity/home/">
          Perplexity
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="https://blog.inductorsoftware.com/Perplexity/home/devOverview">Home</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      





<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">Developer Tutorial Overview</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devOverview/">Overview</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">MRS Conceptual</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/mrscon/devhowto0010MRS/">Minimal Recursion Semantics (MRS)</a></li>
          
            <li><a href="/Perplexity/home/mrscon/devhowto0020WellFormedTree/">Well-Formed Trees</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">MRS Solver Conceptual</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/devcon/devcon0000Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0010MRSSolver/">Backtracking</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0020MRSSolverSets/">Representing 'Together'</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0030MRSSolverSolutionGroups/">Collective, Distributive, Cumulative</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0040MRSSolverSolutionGroupsAlgorithm/">Coll/Dist/Cuml Algorithm</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0050MRSSolverSolutionCombinations/">Combinations and Proper Responses</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0060WhichParseAndTree/">Choosing a Parse and Tree</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0070SentenceForce/">Sentence Types</a></li>
          
            <li><a href="/Perplexity/home/devcon/devcon0080ErrorsChoosingWhichFailure/" class="active">Choosing a Failure</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Perplexity Internals</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/pxint/pxint0000Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0010PredicationContract/">The Predication Contract</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0020PythonBasics/">State and Python Basics</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0030ImplementPredication/">Implementing a Predication</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0040BuildSolver/">Initial Solver</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0050Conjunctions/">Solving Conjunctions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0060ScopalArguments/">Solving Scopal Arguments</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0105ErrorsChoosingWhichFailure/">Choosing a Failure</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0110ErrorsReportingAFailure/">Naive Failures</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0120ErrorsConceptualFailures/">Words in Failures</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0130ErrorsRobustFailure/">Robust Failures</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0070GenerateMRSAndTrees/">Generating MRS and Trees</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0071WhichParseAndTree/">Choosing a Parse and Tree</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0080SimplePropositions/">Propositions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0090SimpleQuestions/">Questions</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint0100SimpleCommands/">Commands</a></li>
          
            <li><a href="/Perplexity/home/pxint/pxint03000PythonDecorators/">A. Python Decorators</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">Using Perplexity</span>
        

        
        <ul>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo010Overview/">Overview</a></li>
          
            <li><a href="/Perplexity/home/pxHowTo/pxHowTo012Install/">Installing Perplexity</a></li>
          
            <li><a href="/Perplexity/home/pxHowTo/pxHowTo014HelloWorld/">Hello World</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo020ImplementAPredication/">Implementing a Predication</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo030InStylePredications/">In-Style Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo040LiftStylePredications/">Lift-Style Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo050EventPredications/">Event Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo070ActionVerbs/">Verb Predications</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo080QuantifiersAndDeterminers/">Quantifiers and Determiners</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo082State/">Custom State</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo085Place/">Representing Places</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo090Prepositions/">Directional Propositions</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo100NonlogicalMeaning/">Solution Group Handlers and Non-logical Meaning</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo105GlobalCriteria/">Solution Group Handlers and Global Criteria</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo110HandlingTenses/">Handling Tenses</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo120ConceptsReferringExpressions/">Conceptual References</a></li>
          
            <li><a href="/Perplexity/home/pxhowto/pxHowTo025SStrings/">A. Generating English with S-strings</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>

    
  
  </div>



  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          


        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h3 id="reporting-the-right-failure">Reporting the Right Failure</h3>
<p>Because a backtracking system can encounter many failures before finding a solution (or not), we have a few challenges to work through in building an approach for reporting errors.</p>

<p>The first challenge is to figure out <em>which</em> of the failures to return. Usually there is more than one. To see why, recall that we are solving MRS by effectively pushing all combinations of items in the world “through” the MRS until we find the ones that make it <code class="language-plaintext highlighter-rouge">true</code>.</p>

<p>For “A file is large”, the MRS and a resolved tree are:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[ TOP: h0
INDEX: e2
RELS: &lt; 
[ _a_q LBL: h4 ARG0: x3 [ x PERS: 3 NUM: sg IND: + ] RSTR: h5 BODY: h6 ]
[ _file_n_of LBL: h7 ARG0: x3 [ x PERS: 3 NUM: sg IND: + ] ARG1: i8 ]
[ _large_a_1 LBL: h1 ARG0: e2 [ e SF: prop TENSE: pres MOOD: indicative PROG: - PERF: - ] ARG1: x3 ]
&gt;
HCONS: &lt; h0 qeq h1 h5 qeq h7 &gt; ]

          ┌────── _file_n_of(x3,i8)
_a_q(x3,RSTR,BODY)    
               └─ _large_a_1(e2,x3)
</code></pre></div></div>

<p>A described in <a href="https://blog.inductorsoftware.com/Perplexity/home/devcon/devcon0010MRSSolver">the section on backtracking</a>, our idealized approach to solving it is:</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">_a_q</code> iteratively sets <code class="language-plaintext highlighter-rouge">x3</code> to each object in the world and calls <code class="language-plaintext highlighter-rouge">_file_n_of</code> with that value</li>
  <li>If <code class="language-plaintext highlighter-rouge">_file_n_of</code> succeeds, <code class="language-plaintext highlighter-rouge">_a_q</code> then calls <code class="language-plaintext highlighter-rouge">_large_a_1</code> with the values returned</li>
  <li>If <code class="language-plaintext highlighter-rouge">large_a_1</code> succeeds, then <code class="language-plaintext highlighter-rouge">a_q</code> succeeds and stops iterating.</li>
</ol>

<p>So, let’s take a world that has the following items in it, run it through the MRS for “A file is large” and see where things fail:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>a folder
a small file
a large file
a dog
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">a folder</code>:</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">_a_q</code> sets <code class="language-plaintext highlighter-rouge">x3</code> to <code class="language-plaintext highlighter-rouge">a folder</code> and calls <code class="language-plaintext highlighter-rouge">_file_n_of</code> with that value</li>
  <li><code class="language-plaintext highlighter-rouge">_file_n_of</code> fails</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">a small file</code>:</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">_a_q</code> sets <code class="language-plaintext highlighter-rouge">x3</code> to <code class="language-plaintext highlighter-rouge">a small file</code> and calls <code class="language-plaintext highlighter-rouge">_file_n_of</code> with that value</li>
  <li><code class="language-plaintext highlighter-rouge">_file_n_of</code> succeeds, <code class="language-plaintext highlighter-rouge">_a_q</code> then calls <code class="language-plaintext highlighter-rouge">_large_a_1</code> with the values returned</li>
  <li><code class="language-plaintext highlighter-rouge">large_a_1</code> fails.</li>
</ol>

<p><code class="language-plaintext highlighter-rouge">a large file</code>:</p>
<ol>
  <li><code class="language-plaintext highlighter-rouge">_a_q</code> sets <code class="language-plaintext highlighter-rouge">x3</code> to <code class="language-plaintext highlighter-rouge">a large file</code> and calls <code class="language-plaintext highlighter-rouge">_file_n_of</code> with that value</li>
  <li><code class="language-plaintext highlighter-rouge">_file_n_of</code> succeeds, <code class="language-plaintext highlighter-rouge">_a_q</code> then calls <code class="language-plaintext highlighter-rouge">_large_a_1</code> with the values returned</li>
  <li><code class="language-plaintext highlighter-rouge">large_a_1</code> succeeds, therefore <code class="language-plaintext highlighter-rouge">a_q</code> succeeds and stops iterating.</li>
</ol>

<p>So, when solving the MRS with this world definition, we hit (in this order):</p>
<ul>
  <li>a <code class="language-plaintext highlighter-rouge">_file_n_of</code> failure</li>
  <li>a <code class="language-plaintext highlighter-rouge">large_a_1</code> failure</li>
  <li>a solution (i.e. no failure)</li>
</ul>

<p>Even though the system hit two failures in solving the MRS, the user that said “a file is large” wouldn’t expect <em>any</em> failures to be reported. They would expect something like “Correct!” to be said.</p>

<p>Another example: What if the user said, “A file is <em>very</em> large”? In solving the MRS with the same world you’d get (in this order):</p>
<ul>
  <li>a <code class="language-plaintext highlighter-rouge">_file_n_of</code> failure</li>
  <li>a <code class="language-plaintext highlighter-rouge">large_a_1</code> failure (since none are “<em>very</em> large”)</li>
  <li>a <code class="language-plaintext highlighter-rouge">large_a_1</code> failure (since none are “<em>very</em> large”)</li>
  <li>a <code class="language-plaintext highlighter-rouge">_file_n_of</code> failure</li>
</ul>

<p>There were 4 failures encountered when solving the MRS for this case. The user would ideally like the error to be something like, “No, there isn’t a very large file”, which presumably corresponds to the middle two. Which heuristic helps us choose those?</p>

<blockquote>
  <p>One heuristic that works well in practice is this: If there is a solution for an MRS, don’t report any errors. If there is no solution for an MRS, report the error from the “deepest/farthest” failure possible.</p>
</blockquote>

<p>The intuition for why this works is this:</p>

<p>If there <em>was</em> a solution, it means that there was a way to make the phrase work logically in the world. Presumably, it will make sense to the user too, even if it isn’t what they meant (though likely it is), so no failure should be reported.</p>

<p>If there <em>wasn’t</em> a solution, the user will want to know why not. The “real” reason is “because the MRS did not have a solution”, but that is unsatisfying and no human would respond with that. A human would respond with where they got blocked attempting to do what the user asked. Furthermore, even if the human tried, or thought about, 10 different approaches to performing the request, they usually won’t describe the 10 ways they tried that didn’t work out. They’ll likely list the failure that is “the closest they got to succeeding”.  For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(In a world where there are 10 things on the counter, 
including milk, and Bob is holding things he can't put down)

Alice: "Could you give me the milk?"
Bob: (good answer) "My hands are full"
Bob: (bad answer) "I thought about handing you ketchup, 
                    but then realized it wasn't milk"
</code></pre></div></div>

<p>The second answer is bad for many reasons, but here we’ll focus on the fact that Alice probably wanted the answer “closest to the solution” as a starting point. She could always ask for more detail or alternative solutions if she really wanted them.</p>

<p>Let’s look into Bob’s head to see how the answers were generated: Bob tried to solve the request by looking at each thing on the counter until he found the milk (that was 9 different “failures” until one succeeded). Then, he tried to “give it to Alice” which failed because his hands were unavailable. The last failure happened “closest to the solution” and generated the best answer. The other 9 failures were earlier in the process and generated less optimal answers. The failures that get the farthest in the tree are usually closest to a solution and thus will usually “make the most sense” to report.</p>

<p>Here’s a more explicit algorithm:</p>
<ul>
  <li>Track the “depth” of each predication in the tree, where “depth” means “call order”</li>
  <li>Every time a predication fails, if it is the “deepest” failure so far, remember that error</li>
  <li>If the MRS has no solutions, report the remembered error to the user</li>
</ul>

<p><a href="https://blog.inductorsoftware.com/Perplexity/home/pxint/pxint0105ErrorsChoosingWhichFailure">Perplexity Internals</a> gives a good example of how Perplexity registers and reports failures using this approach.</p>

<p>Last update: 2023-05-14 by EricZinda [<a href="https://github.com/EricZinda/Perplexity/edit/main/docs/devcon/devcon0080ErrorsChoosingWhichFailure.md">edit</a>]</p>

        
      </section>

      <footer class="page__meta">
        
        


        


      </footer>

      

      
    </div>

    
  </article>

  
  
</div>

<!--Scroll the navbar to the current page-->
<script type="text/javascript">
  let el = document.querySelector('.nav__list .active');
  if(el){
    el.scrollIntoView({block: "center", inline: "start"});
  }
</script>
    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    
      <li><a href="/Perplexity/home/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Your Name. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/Perplexity/home/assets/js/main.min.js"></script>




<script src="/Perplexity/home/assets/js/lunr/lunr.min.js"></script>
<script src="/Perplexity/home/assets/js/lunr/lunr-store.js"></script>
<script src="/Perplexity/home/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
